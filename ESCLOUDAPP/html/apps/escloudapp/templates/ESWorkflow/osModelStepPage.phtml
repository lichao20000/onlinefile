<div id='OsModel_Step_Wind' class='s-estransfer' 
	isFirstCell='<?php echo $data[0];?>'
	modelId='<?php echo $data[1];?>'
	stepId='<?php echo $data[2];?>'
	formId='<?php echo $data[3];?>'
	stepName='<?php echo $data[4];?>'
	isRelation='<?php echo $data[5];?>'
	isRelationByCaller='<?php echo $data[6];?>'
	isCountersign='<?php echo $data[7];?>'
	>
	
	
<form id="OsModel_Step_Form_Id" action="" method="post" isValid="false">

<fieldset class='s-fieldset' style="height:60px;">
  <legend>属性</legend>
  <div class='labelDiv'>
  	<div class="a-label">步骤名称：</div>
	<input class="required" type="text" verify="text/50/1/0" id="ES_STEP_NAME" name="ES_STEP_NAME" value="" style="width:184px;"/>
	<span style="color:red">*</span>
  </div>
</fieldset>
	
	<?php if ($data[3]!='') {?>

<fieldset class='s-fieldset'>
  <legend>表单权限设置（请选择需要编辑的字段）</legend>
  <div class='s-fieldset-bwrap'>
	<div id='userRole' class = "userRole">
	<fieldset class='s-fieldset' style="width:260px;margin-left: 50px;">
		<legend>所有字段</legend>
		  <div id='' class='useLis'>
		    <div class='searchRole'>
		      <input type='text' id='one' class='searchusername' value='' onKeyUp="show(this.value,'left');"/>
			  <img alt="" class='searchuserbutton' src="<?php echo $tplPath;?>/ESTemplate/img/search.bg.gif">
			</div>
		    <ul id='listRole' class='userList'>
		
		 	<?php 
				if(count($allFields)>0){
					foreach($allFields as $value){
						echo '<li><input type="hidden" name='.$value->display.' value='.$value->name.'>'.$value->display.'</li>';
					}
				}
			?>
			</ul>
		  </div>
	</fieldset>

	<div id='esbutton' class='selBut'>  
		<span id="estop" class="estop" title='置顶'></span>
		<span id="esup" class="esup" title='上移'></span>
		<span id="esleft" class="esleft" title='左移'></span>
		<span id="esright" class="esright" title='右移'></span>
		<span id="esdown" class="esdown" title='下移'></span>
		<span id="esbottom" class="esbottom endspan" title='置底'></span>
	</div>
	<fieldset class='s-fieldset' style="width:260px;">
		<legend>已选择字段</legend>
		<div class='useLis'>
			<div class='searchRole'>
				<input type='text' id='two' class='searchusername'  value='' onKeyUp="show(this.value,'right');"/>
				<img alt="" class='searchuserbutton' src="<?php echo $tplPath;?>/ESTemplate/img/search.bg.gif">
			</div>
			<ul id='useRole' class='userList referenceValues'>
			<?php 
				if(count($editFields)>0){
					foreach($editFields as $value){
						echo '<li><input type="hidden" name='.$value->display.' value='.$value->name.'>'.$value->display.'</li>';
					}
				}
			?>
			</ul>
		</div>
	</fieldset>
	</div>
  </div>
</fieldset>
<?php }?>

<fieldset class='s-fieldset'>
  <legend>表单打印设置（请选择需要打印的模板）</legend>
  <div class='s-fieldset-bwrap'>
	<div id='userRole2' class = "userRole">
	<fieldset class='s-fieldset' style="width:260px;margin-left: 50px;">
		<legend>所有模版</legend>
		  <div id='' class='useLis'>
		    <div class='searchRole'>
		      <input type='text' id='one2' class='searchusername' value='' onKeyUp="show2(this.value,'left');"/>
			  <img alt="" class='searchuserbutton' src="<?php echo $tplPath;?>/ESTemplate/img/search.bg.gif">
			</div>
		    <ul id='listRole2' class='userList'>
		
		 	<?php 
				if(count($allFieldPrint)>0){
					foreach($allFieldPrint as $value){
						echo '<li><input type="hidden" name='.$value->display.' value='.$value->name.'>'.$value->display.'</li>';
					}
				}
			?>
			</ul>
		  </div>
	</fieldset>

	<div id='esbutton2' class='selBut'>  
		<span id="estop2" class="estop" title='置顶'></span>
		<span id="esup2" class="esup" title='上移'></span>
		<span id="esleft2" class="esleft" title='左移'></span>
		<span id="esright2" class="esright" title='右移'></span>
		<span id="esdown2" class="esdown" title='下移'></span>
		<span id="esbottom2" class="esbottom endspan" title='置底'></span>
	</div>
	<fieldset class='s-fieldset' style="width:260px;">
		<legend>已选择模板</legend>
		<div class='useLis'>
			<div class='searchRole'>
				<input type='text' id='two2' class='searchusername'  value='' onKeyUp="show2(this.value,'right');"/>
				<img alt="" class='searchuserbutton' src="<?php echo $tplPath;?>/ESTemplate/img/search.bg.gif">
			</div>
			<ul id='useRole2' class='userList referenceValues'>
			<?php 
				if(count($editFieldPrint)>0){
					foreach($editFieldPrint as $value){
						echo '<li><input type="hidden" name='.$value->display.' value='.$value->name.'>'.$value->display.'</li>';
					}
				}
			?>
			</ul>
		</div>
	</fieldset>
	</div>
  </div>
</fieldset>

<?php 
	if (!$data[0] || $data[0]=='false') {
?>
<fieldset class='s-fieldset' style="height:480px;">
  <legend>选择处理人</legend>
  <div style='margin-bottom:12px'>
  	<label><input type='radio' id='ES_STEP_ROLE_SELECT' name='ES_STEP_OWER_SELECT'  onclick="modelStep.stepRoleSelect($('#OsModel_Step_Wind').attr('modelId'),$('#OsModel_Step_Wind').attr('stepId'),true)"/>按角色选择</label>
  	<label><input type='radio' id='ES_STEP_USER_SELECT' name='ES_STEP_OWER_SELECT'  onclick="modelStep.stepOrganSelect($('#OsModel_Step_Wind').attr('modelId'),$('#OsModel_Step_Wind').attr('stepId'),true)" checked="checked"/>按机构选择</label>
  	<label><input type="checkbox" id='ES_STEP_ISRELATION_FORM_ORGAN' name='ES_STEP_ISRELATION_FORM_ORGAN'/>根据上一步处理人机构过滤</label>
  	<label><input type="checkbox" id='ES_STEP_ISRELATION_FORM_ORGAN_BY_CALLER' name='ES_STEP_ISRELATION_FORM_ORGAN_BY_CALLER'/>根据发起人机构过滤</label>
  </div>
  <div class='s-left'>
  	<div id="selectType" class="s-left-top">
  	  <div id="wfModelStep_Select_Tree" selectNodeId="0">
  	    <ul id="wfModelStep_Select_Organ_Tree" class="ztree"></ul>
  	  </div>
  	  <div id="wfModelStep_Select_Role" class='s-role'>
  	  	<div id="osModel_step_Role_select" style="height: 80px;"></div>
  	  </div>
  	</div>
  	<div class='s-left-buttom s-user'>
  	  <div id="osModel_step_user_select_organ" style="height: 120px;"></div>
  	</div>
  </div>
  <div class='s-right'>
  	<div id='osModel_step_user_selected'></div>
  </div>
  	
</fieldset>


<?php 
	}
?>

</form>
</div>
<script type="text/javascript" src="<?php echo $tplPath;?>/ESWorkflow/js/orgListTree.js"></script>
<script type="text/javascript" src="<?php echo $tplPath;?>/ESWorkflow/js/modelStepManager.js"></script>
<script>
$(function(){
	// 初始化数据
	function init(){
		// 修改样式
		var htDiv2HtmlUser = $('.s-user .tDiv2').html();
		var recHtmlUser = '<div class="find-dialog" style="left:8px;position:relative;margin-right:260px"><input id="userKeyWord" onblur="if($(this).val()==\'\')$(this).val(\'请输入关键字\')" onfocus="if($(this).val()==\'请输入关键字\')$(this).val(\'\')" type="text" name="userKeyWord" value="请输入关键字" /><span onclick="modelStep.getUserQuery()"></span></div>' + htDiv2HtmlUser;
		$('.s-user .tDiv2').html(recHtmlUser);
		// 修改样式
		var htDiv2HtmlRole = $('.s-role .tDiv2').html();
		var recHtmlRole = '<div class="find-dialog" style="left:8px;position:relative;margin-right:260px"><input id="roleKeyWord" onblur="if($(this).val()==\'\')$(this).val(\'请输入关键字\')" onfocus="if($(this).val()==\'请输入关键字\')$(this).val(\'\')" type="text" name="roleKeyWord" value="请输入关键字" /><span onclick="modelStep.getRoleQuery()"></span></div>' + htDiv2HtmlRole;
		$('.s-role .tDiv2').html(recHtmlRole);
		// 修改样式
		$('.s-right .tDiv2').append('<label style="margin:4px 0 0 70px;"><input type="checkbox" id="ES_STEP_ISCOUNTERSIGN" name="ES_STEP_ISCOUNTERSIGN"/>是否会签</label>');
		
		$('#wfModelStep_Select_Role').hide();
		$('#ES_STEP_NAME').val($('#OsModel_Step_Wind').attr('stepName'));

		if($('#OsModel_Step_Wind').attr('isRelation')=='1'){
			$('#ES_STEP_ISRELATION_FORM_ORGAN').attr("checked",true);
		}

		//如果按发起人进行过滤，则按上一步处理人过滤复选框设为不可用且取消勾选。
		if($('#OsModel_Step_Wind').attr('isRelationByCaller')=='1'){
			$('#ES_STEP_ISRELATION_FORM_ORGAN_BY_CALLER').attr("checked",true);
			$('#ES_STEP_ISRELATION_FORM_ORGAN').attr("checked",false);
			$('#ES_STEP_ISRELATION_FORM_ORGAN').attr('disabled', true);
		}
		
		if($('#OsModel_Step_Wind').attr('isCountersign')=='1'){
			$('#ES_STEP_ISCOUNTERSIGN').attr("checked",true);
		}

		$('.s-user .btnToRight').click(function(){
			modelStep.toRight4User();
		});

		$('.s-role .btnToRight').click(function(){
			modelStep.toRight4Role();
		});
	}
	init();

	$('#ES_STEP_ISRELATION_FORM_ORGAN_BY_CALLER').click(function(){
		if($(this).attr('checked')) {
			$('#ES_STEP_ISRELATION_FORM_ORGAN').attr("checked",false);
			$('#ES_STEP_ISRELATION_FORM_ORGAN').attr('disabled', true);
		}else{
			$('#ES_STEP_ISRELATION_FORM_ORGAN').attr('disabled', false);
		}
	});

	$('#osModel_step_user_selected').find('tr').die().live("dblclick", function(){
		modelStep.rowDblclick_stepSelected(this);
	}); 

	$('#osModel_step_user_select_organ').find('tr').die().live("dblclick", function(){
		modelStep.rowDblclick_stepSelected_user(this);
	}); 
	
	$('#osModel_step_Role_select').find('tr').die().live("click", function(){
		modelStep.rowClick_stepSelected_role(this);
	}); 
	
	$(document).keydown(function(event){
		var activeId = document.activeElement.id;
		if(event.keyCode == 13 && activeId == 'roleKeyWord') {
			modelStep.getRoleQuery();
			return false;
		} else if (event.keyCode == 13 && activeId == 'userKeyWord') {
			modelStep.getUserQuery();
			return false;
		}
	});
});

</script>
<style>
.ztree li span{
	color:#444;
}
</style>
